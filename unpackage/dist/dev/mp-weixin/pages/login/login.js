(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{48:function(e,t,n){"use strict";(function(e){n(5);o(n(4));var t=o(n(49));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n(1)["createPage"])},49:function(e,t,n){"use strict";n.r(t);var o=n(50),r=n(52);for(var i in r)"default"!==i&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n(55);var a,s=n(11),c=Object(s["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],a);c.options.__file="pages/login/login.vue",t["default"]=c.exports},50:function(e,t,n){"use strict";n.r(t);var o=n(51);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},51:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return r})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return i})),n.d(t,"components",(function(){return o}));try{o={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,176))},uniFormsItem:function(){return n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(n.bind(null,185))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,192))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement;e._self._c},i=!1,a=[];r._withStripped=!0},52:function(e,t,n){"use strict";n.r(t);var o=n(53),r=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=r.a},53:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(13)),r=n(16),i=n(54);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,o,r,i,a){try{var s=e[i](a),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(o,r)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){s(i,o,r,a,c,"next",e)}function c(e){s(i,o,r,a,c,"throw",e)}a(void 0)}))}}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){n.e("components/common/myp-one/myp-one").then(function(){return resolve(n(199))}.bind(null,n)).catch(n.oe)},p={data:function(){return{form:{phone:"",captcha:""},title:"登录体验更多精彩",subTitle:"新用户将自动注册",isSend:!1,className:"clickable",count:"",message:"",timer:null,reg:/^((13[0-9])|(14[5,7,9])|(15[^4])|(18[0-9])|(17[0,1,3,5,6,7,8]))\d{8}$/}},components:{oneInput:d},computed:l({},(0,r.mapState)(["token","myInfo"])),methods:l(l({},(0,r.mapMutations)(["updateIsLogin","updateToken","updateMyInfo","updateMyMusicList"])),{},{sendCaptcha:function(){var t=c(o.default.mark((function t(){var n,r,a=this;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==this.form.phone&&void 0!==this.form.phone){t.next=4;break}e.showToast({title:"请输入手机号码",duration:2e3,icon:"none"}),t.next=13;break;case 4:if(this.reg.test(this.form.phone)){t.next=8;break}e.showToast({title:"请输入正确的手机号码",duration:2e3,icon:"none"}),t.next=13;break;case 8:return console.log("?",this.form),t.next=11,(0,i.getCaptcha)({phone:this.form.phone});case 11:n=t.sent,200==n.data.code?(this.className="unclickable",this.message="s后重发",this.title="请输入验证码",this.subTitle="已发送至+86 "+this.form.phone,this.isSend=!0,r=60,this.timer||(this.count=r,this.timer=setInterval((function(){a.count>0&&a.count<=r?a.count--:(clearInterval(a.timer),a.count="",a.className="clickable",a.message="重新发送",a.timer=null)}),1e3))):e.showToast({icon:"error",title:n.data.message,duration:2e3});case 13:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),getUserDetail:function(){var t=c(o.default.mark((function t(n){var r,a,s,c;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,i.getUserDetail)(n);case 2:return r=t.sent,console.log("详情",r),a=r.data,s={id:a.profile.userId,name:a.profile.nickname,follow:a.profile.follows,fans:a.profile.followeds,src:a.profile.avatarUrl,level:a.level},t.next=8,(0,i.getMyMusicList)(n);case 8:c=t.sent,this.updateMyMusicList(c.data.playlist),this.updateMyInfo(s),console.log("我的信息",this.myInfo),e.setStorageSync("myInfo",JSON.stringify(s));case 13:case"end":return t.stop()}}),t,this)})));function n(e){return t.apply(this,arguments)}return n}(),login:function(){var t=c(o.default.mark((function t(){var n,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,i.verifyCaptcha)({phone:this.form.phone,captcha:this.form.captcha});case 2:if(n=t.sent,console.log("验证",n),!n.data.data){t.next=12;break}return t.next=7,(0,i.phoneLogin)({phone:this.form.phone,captcha:this.form.captcha});case 7:r=t.sent,console.log("登录结果",r),200===r.data.code?(this.updateToken(r.data.token),e.setStorageSync("token",r.data.token),this.getUserDetail(r.data.account.id),e.setStorageSync("account",JSON.stringify(n.data.account)),e.setStorageSync("profile",JSON.stringify(n.data.profile)),e.switchTab({url:"/pages/tabBar/found/found",success:function(){e.showToast({title:"登录成功",duration:2e3})},fail:function(e){console.log(e)}})):e.showToast({icon:"error",title:r.data.message,duration:2e3}),t.next=13;break;case 12:e.showToast({title:"手机或验证码输入有误",duration:2e3,icon:"none"});case 13:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}()})};t.default=p}).call(this,n(1)["default"])},55:function(e,t,n){"use strict";n.r(t);var o=n(56),r=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=r.a},56:function(e,t,n){}},[[48,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map