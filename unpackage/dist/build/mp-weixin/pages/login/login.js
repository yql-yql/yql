(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"1b56":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"5b9d"))},uniFormsItem:function(){return n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(n.bind(null,"64b1"))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,"af3e"))}},r=function(){var e=this,t=e.$createElement;e._self._c},a=[]},"33e1":function(e,t,n){"use strict";var o=n("3d0f"),r=n.n(o);r.a},"3d0f":function(e,t,n){},4782:function(e,t,n){"use strict";(function(e){n("a96b");o(n("66fd"));var t=o(n("f201"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},"6dda":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("a34a")),r=n("26cb"),a=n("5890");function i(e){return e&&e.__esModule?e:{default:e}}function u(e,t,n,o,r,a,i){try{var u=e[a](i),s=u.value}catch(c){return void n(c)}u.done?t(s):Promise.resolve(s).then(o,r)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function i(e){u(a,o,r,i,s,"next",e)}function s(e){u(a,o,r,i,s,"throw",e)}i(void 0)}))}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){n.e("components/common/myp-one/myp-one").then(function(){return resolve(n("27a1"))}.bind(null,n)).catch(n.oe)},p={data:function(){return{form:{phone:"",captcha:""},title:"登录体验更多精彩",subTitle:"新用户将自动注册",isSend:!1,className:"clickable",count:"",message:"",timer:null,reg:/^((13[0-9])|(14[5,7,9])|(15[^4])|(18[0-9])|(17[0,1,3,5,6,7,8]))\d{8}$/}},components:{oneInput:d},computed:l({},(0,r.mapState)(["token","myInfo"])),methods:l(l({},(0,r.mapMutations)(["updateIsLogin","updateToken","updateMyInfo","updateMyMusicList"])),{},{sendCaptcha:function(){var t=s(o.default.mark((function t(){var n,r,i=this;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""!==this.form.phone&&void 0!==this.form.phone){t.next=4;break}e.showToast({title:"请输入手机号码",duration:2e3,icon:"none"}),t.next=13;break;case 4:if(this.reg.test(this.form.phone)){t.next=8;break}e.showToast({title:"请输入正确的手机号码",duration:2e3,icon:"none"}),t.next=13;break;case 8:return console.log("?",this.form),t.next=11,(0,a.getCaptcha)({phone:this.form.phone});case 11:n=t.sent,200==n.data.code?(this.className="unclickable",this.message="s后重发",this.title="请输入验证码",this.subTitle="已发送至+86 "+this.form.phone,this.isSend=!0,r=60,this.timer||(this.count=r,this.timer=setInterval((function(){i.count>0&&i.count<=r?i.count--:(clearInterval(i.timer),i.count="",i.className="clickable",i.message="重新发送",i.timer=null)}),1e3))):e.showToast({icon:"error",title:n.data.message,duration:2e3});case 13:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}(),getUserDetail:function(){var t=s(o.default.mark((function t(n){var r,i,u,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,a.getUserDetail)(n);case 2:return r=t.sent,console.log("详情",r),i=r.data,u={id:i.profile.userId,name:i.profile.nickname,follow:i.profile.follows,fans:i.profile.followeds,src:i.profile.avatarUrl,level:i.level},t.next=8,(0,a.getMyMusicList)(n);case 8:s=t.sent,this.updateMyMusicList(s.data.playlist),this.updateMyInfo(u),console.log("我的信息",this.myInfo),e.setStorageSync("myInfo",JSON.stringify(u));case 13:case"end":return t.stop()}}),t,this)})));function n(e){return t.apply(this,arguments)}return n}(),login:function(){var t=s(o.default.mark((function t(){var n,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,a.verifyCaptcha)({phone:this.form.phone,captcha:this.form.captcha});case 2:if(n=t.sent,console.log("验证",n),!n.data.data){t.next=12;break}return t.next=7,(0,a.phoneLogin)({phone:this.form.phone,captcha:this.form.captcha});case 7:r=t.sent,console.log("登录结果",r),200===r.data.code?(e.showToast({title:"登录成功",duration:2e3}),this.updateToken(r.data.token),e.setStorageSync("token",r.data.token),this.getUserDetail(r.data.account.id),e.setStorageSync("account",JSON.stringify(n.data.account)),e.setStorageSync("profile",JSON.stringify(n.data.profile)),e.switchTab({url:"/pages/tabBar//found/found",fail:function(e){console.log(e)}})):e.showToast({icon:"error",title:r.data.message,duration:2e3}),t.next=13;break;case 12:e.showToast({title:"手机或验证码输入有误",duration:2e3,icon:"none"});case 13:case"end":return t.stop()}}),t,this)})));function n(){return t.apply(this,arguments)}return n}()})};t.default=p}).call(this,n("543d")["default"])},8199:function(e,t,n){"use strict";n.r(t);var o=n("6dda"),r=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a},f201:function(e,t,n){"use strict";n.r(t);var o=n("1b56"),r=n("8199");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("33e1");var i,u=n("f0c5"),s=Object(u["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=s.exports}},[["4782","common/runtime","common/vendor"]]]);